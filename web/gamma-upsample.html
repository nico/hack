<!doctype html>
<meta name="color-scheme" content="light dark">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>image upsampling test</title>
<style>
/* Based on https://thecascade.dev/article/least-amount-of-css/ */
body {
  font-family: system-ui;
  line-height: 1.5;
  max-width: min(70ch, 100% - 4rem);
  margin-inline: auto;
}

img { display: block; }
</style>
<h1>Gamma-Correct Image Upsampling</h1>

<p>
<strong>⚠️ Note:</strong> This works only on a screen with a 2x scale factor,
such as on all recent Macs.

<h2>Source Image</h2>
<p>
Here's an image (credit: Jonas Berlin, <a href="http://www.ericbrasseur.org/gamma.html#:~:text=Jonas%20Berlin%20sent%20this%20image">source</a>).


<details>
<summary>(It uses a hack to force it to be displayed at 1:1 pixel scale.)</summary>

<p>
It's displayed by using the same image file for both the <code>1x</code> and
<code>2x</code> variants, like so:

<p>
<pre>
<code>
&lt;img srcset="gamma-1.0-or-2.2.png 1x, gamma-1.0-or-2.2.png 2x"
     src="http://www.ericbrasseur.org/gamma-1.0-or-2.2.png" /&gt;
</code>
</pre>

<p>
(That's not how <code>srcset</code> is supposed to be used! Normally, you'd use
an image of twice the resolution for the <code>2x</code> image. We use it as a
hack here to make sure that browsers don't scale up the image on retina
screens.)

</details>

<p>
<img srcset="gamma-1.0-or-2.2.png 1x, gamma-1.0-or-2.2.png 2x"
     src="gamma-1.0-or-2.2.png" />

<h2>Gamma-Correct Upsampled Image</h2>
<p>
Here's the same image scaled up 2x, using software that does gamma-correct
image upsampling. It also uses the hack mentioned above to show it at 1x zoom on
retina screens:

<p>
<img srcset="gamma-1.0-or-2.2-2x.png 1x, gamma-1.0-or-2.2-2x.png 2x"
     src="gamma-1.0-or-2.2-2x.png" />

<details>
<summary>How I made the gamma-correctly upsampled image</summary>

<p>
I used <a href="https://entropymine.com/imageworsener/">imageworsener</a>,
with this command:

<p>
<pre>
<code>
./imagew -filter triangle -w 1024 -h 512 gamma-1.0-or-2.2.png out.png
</code>
</pre>

<p>
This tells imageworsener to use a bilinear filter. It uses gamma-correct
resampling by default. If you also pass <code>-nogamma</code>, you will get
the behavior that browsers currently get you, see below.
</details>

<h2>How Your Browser Upsamples It</h2>
<p>
Here's the image how your browser displays it when just using
<code>&lt;img src="gamma-1.0-or-2.2.png" /&gt;</code> (i.e. how it
displays most images on the web):

<p>
<img src="gamma-1.0-or-2.2.png" />

<h1>Do Browsers Get This Right?</h1>
<p>
At the time of this writing (Oct 2025), none of the major browsers do
gamma-correct image upsampling -- even though this is how the majority of the
images on the web are displayed on retina screens, and even though they
changed their image downsampling long ago to be gamma-correct.

<ul>
<li><a href="https://crbug.com/370013920">Chromium bug</a>
<li><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1997150">Firefox bug</a>
<li><a href="https://bugs.webkit.org/show_bug.cgi?id=301637">Safari bug</a>
</ul>

<h1>Background</h1>

<p>
A while ago, Eric Brasseur did a 
<a href="http://www.ericbrasseur.org/gamma.html">detailed write-up
on gamma-correct image sampling</a>. It explains what gamma-correct image
resampling is. It focused on downsampling. It looks like all browsers fixed
their downsampling in response, but upsampling still has the same problem.

<h1>Effect on Dithering Demos</h1>

<p>
This is why articles about dithering that bother to deal with gamma
correction tend to include a disclaimer along the lines "trust me, this
is really better, even though it looks worse in your browser": The browser
gamma-incorrectly upsamples the source and dithered images, and if you do
gamma-incorecct dithering, the errors cancel out!
